<!DOCTYPE html>

<html>
<head>
  <title>Time Signature</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="..\..\..\..\..\..\docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <div class="toctop">
            <a class="source" href="..\..\..\..\..\..\index.html">Home</a>
            <h3>Table of Contents</h3>
              
                    
                    <div class="toc">
                        <h3>src\main\antlr</h3>
                        
                            <li class="tocelem">
                                <a class="source" href="..\..\..\..\antlr\MellowDLexer.html">
                                    MellowDLexer.g4
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="..\..\..\..\antlr\MellowDParser.html">
                                    MellowDParser.g4
                                </a>
                            </li>
                        
                        </div>
                    
                    <div class="toc">
                        <h3>src\main\java\cas\cs4tb3\mellowd</h3>
                        
                            <li class="tocelem">
                                <a class="source" href="ArticulatedSound.html">
                                    ArticulatedSound.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="Articulation.html">
                                    Articulation.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="Beat.html">
                                    Beat.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="Dynamic.html">
                                    Dynamic.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="Pitch.html">
                                    Pitch.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="PlayableSound.html">
                                    PlayableSound.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="TimingEnvironment.html">
                                    TimingEnvironment.java
                                </a>
                            </li>
                        
                        </div>
                    
                    <div class="toc">
                        <h3>src\main\java\cas\cs4tb3\mellowd\compiler</h3>
                        
                            <li class="tocelem">
                                <a class="source" href="compiler\Compiler.html">
                                    Compiler.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="compiler\SequencePlayer.html">
                                    SequencePlayer.java
                                </a>
                            </li>
                        
                        </div>
                    
                    <div class="toc">
                        <h3>src\main\java\cas\cs4tb3\mellowd\midi</h3>
                        
                            <li class="tocelem">
                                <a class="source" href="midi\GeneralMidiConstants.html">
                                    GeneralMidiConstants.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="midi\GeneralMidiInstrument.html">
                                    GeneralMidiInstrument.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="midi\GeneralMidiPercussion.html">
                                    GeneralMidiPercussion.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="midi\MidiNoteMessageSource.html">
                                    MidiNoteMessageSource.java
                                </a>
                            </li>
                        
                        </div>
                    
                    <div class="toc">
                        <h3>src\main\java\cas\cs4tb3\mellowd\parser</h3>
                        
                            <li class="tocelem">
                                <a class="source" href="parser\Block.html">
                                    Block.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="parser\BlockOptions.html">
                                    BlockOptions.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="parser\IncorrectTypeException.html">
                                    IncorrectTypeException.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="parser\ParseException.html">
                                    ParseException.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="parser\SymbolTable.html">
                                    SymbolTable.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="parser\TrackManager.html">
                                    TrackManager.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="parser\UndefinedReferenceException.html">
                                    UndefinedReferenceException.java
                                </a>
                            </li>
                        
                        </div>
                    
                    <div class="toc">
                        <h3>src\main\java\cas\cs4tb3\mellowd\primitives</h3>
                        
                            <li class="tocelem">
                                <a class="source" href="primitives\Chord.html">
                                    Chord.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="primitives\Melody.html">
                                    Melody.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="primitives\Phrase.html">
                                    Phrase.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="primitives\Rhythm.html">
                                    Rhythm.java
                                </a>
                            </li>
                        
                        </div>
                    
                    <div class="toc">
                        <h3>src\test\java\cas\cs4tb3\mellowd</h3>
                        
                            <li class="tocelem">
                                <a class="source" href="..\..\..\..\..\test\java\cas\cs4tb3\mellowd\ChordResolutionTest.html">
                                    ChordResolutionTest.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="..\..\..\..\..\test\java\cas\cs4tb3\mellowd\ParserTest.html">
                                    ParserTest.java
                                </a>
                            </li>
                        
                            <li class="tocelem">
                                <a class="source" href="..\..\..\..\..\test\java\cas\cs4tb3\mellowd\TestErrorListener.html">
                                    TestErrorListener.java
                                </a>
                            </li>
                        
                        </div>
                    
          </div>
        
            
            <!-- Moved TOC above header -->
            
          
          <h1 id="time-signature">Time Signature</h1>

          
            <div class='highlight'><pre>
<span class="hljs-keyword">package</span> cas.cs4tb3.mellowd;

<span class="hljs-keyword">import</span> javax.sound.midi.*;</pre></div>
          
        
      </div>

      
        
        <p>The <code>TimingEnvironment</code> class handles timing information for a sequence. It allows for
conversion from a classical timing definition of a beat to a MIDI tick count. It is
also responsible for modifying the time signature and tempo of the sequence with the
creation of the appropriate MIDI meta messages. See</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimingEnvironment</span> </span>{</pre></div>
        
      
        
        <p>The MIDI meta message identifier for a time signature message.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span> TIME_SIGNATURE_MIDI_SUBTYPE = <span class="hljs-number">0x58</span>;</pre></div>
        
      
        
        <p>The MIDI meta message identifier for a tempo message.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span> TEMPO_MIDI_SUBTYPE = <span class="hljs-number">0x51</span>;</pre></div>
        
      
        
        <p>The number of microseconds in each minute (60,000,000). This constant aids
in calculating the microseconds per beat for a BPM conversion.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MICROSECONDS_PER_MINUTE = <span class="hljs-number">60000000</span>;</pre></div>
        
      
        
        <p>This constant is the number of ticks that need to pass on the MIDI clock for the
metronome to click. This clock is independent from the sequencer clock. Redefining
the PPQN should not affect this clock. Therefore we will leave it at the standard 24 ticks
per click.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span> TICKS_PER_METER_CLICK = <span class="hljs-number">24</span>;</pre></div>
        
      
        
        <p>This constant appears in the time signature midi message. <sup>1</sup>&frasl;<sub>4</sub>
consists of 8 <sup>1</sup>&frasl;<sub>32</sub>. There should be no reason to change this.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span> THIRTY_SECOND_NOTES_PER_QUARTER = <span class="hljs-number">8</span>;</pre></div>
        
      
        
        <p>The <code>PPQN</code> is the Pulses Per Quarter Note. It is also referred to as simply <code>PPQ</code>.
It will be 960 by default for all sequences but reserve the right to change it
if we need a higher resolution. This is the number of clock ticks that pass over
the duration of a single quarter note.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_PPQN = <span class="hljs-number">960</span>;</pre></div>
        
      
        
        <p>Store all of the timing information. The time signature is
<sup>timeSigNum</sup>&frasl;<sub>timeSigDen</sub>. Our pluses per quarter note
and our tempo.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">byte</span> timeSigNum;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">byte</span> timeSigDen;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> ppqn;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> bpm;</pre></div>
        
      
        
        <p>The numerator and denominator for the time signature gives the synthesiser some hints
on what are the down and up beats. The bpm is the tempo.</p>

        
          <div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TimingEnvironment</span><span class="hljs-params">(<span class="hljs-keyword">byte</span> numerator, <span class="hljs-keyword">byte</span> denominator, <span class="hljs-keyword">int</span> bpm)</span> </span>{
        <span class="hljs-keyword">this</span>.timeSigNum = numerator;
        <span class="hljs-keyword">this</span>.timeSigDen = denominator;
        <span class="hljs-keyword">this</span>.ppqn = DEFAULT_PPQN;
        <span class="hljs-keyword">this</span>.bpm = bpm;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Sequence <span class="hljs-title">createSequence</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            Sequence s = <span class="hljs-keyword">new</span> Sequence(Sequence.PPQ, ppqn);
            Track timeDataTrack = s.createTrack();
            timeDataTrack.add(<span class="hljs-keyword">new</span> MidiEvent(<span class="hljs-keyword">this</span>.timeSignatureMessage(), <span class="hljs-number">0</span>));
            timeDataTrack.add(<span class="hljs-keyword">new</span> MidiEvent(<span class="hljs-keyword">this</span>.tempoMessage(), <span class="hljs-number">0</span>));
            <span class="hljs-keyword">return</span> s;
        } <span class="hljs-keyword">catch</span> (InvalidMidiDataException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);
        }
    }</pre></div>
        
      
        
        <p>Get the number of ticks per quarter note. This is the resolution of the timing.</p>

        
          <div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPPQ</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> ppqn;
    }</pre></div>
        
      
        
        <p>Get the tempo in beats per minute.</p>

        
          <div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getTempo</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.bpm;
    }</pre></div>
        
      
        
        <p>The <code>PPQN</code> was chosen as to support triplets on an integer number of
ticks but the resolution of other ratios will vary and some precision
may be lost when cast to a long.</p>

        
          <div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ticksInBeat</span><span class="hljs-params">(Beat beat)</span> </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">long</span>) (ppqn * beat.getNumQuarters());
    }</pre></div>
        
      
        
        <p>Create a MIDI message that can be sent to set the time signature of
the sequence to this time signature.</p>

        
          <div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">public</span> MetaMessage <span class="hljs-title">timeSignatureMessage</span><span class="hljs-params">()</span> </span>{
        MetaMessage timeSigMessage = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            timeSigMessage = <span class="hljs-keyword">new</span> MetaMessage(TIME_SIGNATURE_MIDI_SUBTYPE, <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[] {
                    timeSigNum,
                    timeSigDen,
                    TICKS_PER_METER_CLICK,
                    THIRTY_SECOND_NOTES_PER_QUARTER
            }, <span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InvalidMidiDataException ignored) {
            <span class="hljs-comment">/* Will never happen as the message type is a defined constant */</span>
        }
        <span class="hljs-keyword">return</span> timeSigMessage;
    }</pre></div>
        
      
        
        <p>Create a MIDI message that can be sent to set the tempo of
the sequence to this tempo.</p>

        
          <div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">public</span> MetaMessage <span class="hljs-title">tempoMessage</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">int</span> microSecPerBeat = MICROSECONDS_PER_MINUTE / bpm;
        MetaMessage tempoMessage = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            tempoMessage = <span class="hljs-keyword">new</span> MetaMessage(TEMPO_MIDI_SUBTYPE, <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[] {
                    (<span class="hljs-keyword">byte</span>) ((microSecPerBeat &gt;&gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>),
                    (<span class="hljs-keyword">byte</span>) ((microSecPerBeat &gt;&gt;&gt; <span class="hljs-number">8</span> ) &amp; <span class="hljs-number">0xFF</span>),
                    (<span class="hljs-keyword">byte</span>) ((microSecPerBeat       ) &amp; <span class="hljs-number">0xFF</span>)
            }, <span class="hljs-number">3</span>);
        } <span class="hljs-keyword">catch</span> (InvalidMidiDataException ignored) {
            <span class="hljs-comment">/* Will never happen as the message type is a defined constant */</span>
        }
        <span class="hljs-keyword">return</span> tempoMessage;
    }
}</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
